<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit N-mixture Time-to-detection Models — nmixTTD • unmarked</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit N-mixture Time-to-detection Models — nmixTTD" />
<meta property="og:description" content="Fit N-mixture models with time-to-detection data." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unmarked</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rbchan/unmarked/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit N-mixture Time-to-detection Models</h1>
    
    <div class="hidden name"><code>nmixTTD.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit N-mixture models with time-to-detection data.</p>
    </div>

    <pre class="usage"><span class='fu'>nmixTTD</span><span class='op'>(</span>stateformula<span class='op'>=</span> <span class='op'>~</span><span class='fl'>1</span>, detformula <span class='op'>=</span> <span class='op'>~</span><span class='fl'>1</span>, <span class='va'>data</span>, K<span class='op'>=</span><span class='fl'>100</span>,
    mixture <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"P"</span>,<span class='st'>"NB"</span><span class='op'>)</span>, ttdDist <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"exp"</span>, <span class='st'>"weibull"</span><span class='op'>)</span>, <span class='va'>starts</span>, method<span class='op'>=</span><span class='st'>"BFGS"</span>, 
    se<span class='op'>=</span><span class='cn'>TRUE</span>, engine <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"C"</span>, <span class='st'>"R"</span><span class='op'>)</span>, threads <span class='op'>=</span> <span class='fl'>1</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>stateformula</th>
      <td><p>Right-hand sided formula for the abundance at each site.</p></td>
    </tr>
    <tr>
      <th>detformula</th>
      <td><p>Right-hand sided formula for mean time-to-detection.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p><code>unmarkedFrameOccuTTD</code> object that supplies the data
    (see <code><a href='unmarkedFrameOccuTTD.html'>unmarkedFrameOccuTTD</a></code>). Note that only single-season
    models are supported by <code>nmixTTD</code>.</p></td>
    </tr>
    <tr>
      <th>K</th>
      <td><p>The upper summation index used to numerically integrate out the
    latent abundance. This should be set high enough so that it does not
    affect the parameter estimates. Computation time will increase with K.</p></td>
    </tr>
    <tr>
      <th>mixture</th>
      <td><p>String specifying mixture distribution: "P" for Poisson or 
    "NB" for negative binomial.</p></td>
    </tr>
    <tr>
      <th>ttdDist</th>
      <td><p>Distribution to use for time-to-detection; either
    <code>"exp"</code> for the exponential, or <code>"weibull"</code> for the Weibull,
    which adds an additional shape parameter \(k\).</p></td>
    </tr>
    <tr>
      <th>starts</th>
      <td><p>optionally, initial values for parameters in the optimization.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Optimization method used by <code><a href='https://rdrr.io/r/stats/optim.html'>optim</a></code>.</p></td>
    </tr>
    <tr>
      <th>se</th>
      <td><p>logical specifying whether or not to compute standard errors.</p></td>
    </tr>
    <tr>
      <th>engine</th>
      <td><p>Either "C" or "R" to use fast C++ code or native R
    code during the optimization.</p></td>
    </tr>
    <tr>
      <th>threads</th>
      <td><p>Set the number of threads to use for optimization in C++, if
      OpenMP is available on your system. Increasing the number of threads
      may speed up optimization in some cases by running the likelihood 
      calculation in parallel. If <code>threads=1</code> (the default), OpenMP is disabled.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments to optim, such as lower and upper bounds</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>unmarkedFitNmixTTD object describing model fit.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<p>This model extends time-to-detection (TTD) occupancy models to estimate site 
abundance using data from single or repeated visits. Latent abundance can be 
modeled as Poisson (<code>mixture="P"</code>) or negative binomial (<code>mixture="NB"</code>). 
Time-to-detection can be modeled as an exponential (<code>ttdDist="exp"</code>) or 
Weibull (<code>ttdDist="weibull"</code>) random variable with rate parameter \(\lambda\) 
and, for the Weibull, an additional shape parameter \(k\). Note that 
<code>occuTTD</code> puts covariates on \(\lambda\) and not \(1/\lambda\), i.e., 
the expected time between events.</p>
<p>Assuming that there are \(N\) independent individuals at a site, and all
individuals have the same individual detection rate, the expected
detection rate across all individuals \(\lambda\) is equal to the the 
individual-level detection rate \(r\) multipled by the number of individuals
present \(N\).</p>
<p>In the case where there are no detections before the maximum sample time at
a site (<code>surveyLength</code>) is reached, we are not sure if the site has 
\(N=0\) or if we just didn't wait long enough for a detection. We therefore 
must censor (\(C\) the exponential or Weibull distribution at the maximum survey 
length, \(Tmax\). Thus, assuming true abundance at site \(i\) is 
\(N_i\), and an exponential distribution for the TTD \(y_i\) (parameterized 
with the rate), then:</p>
<p>$$y_i \sim Exponential(r_i * N_i) C(Tmax)$$</p>
<p>Note that when \(N_i = 0\), the exponential rate \(lambda = 0\) and the
scale is therefore \(1 / 0 = Inf\), and thus the value will be censored
at \(Tmax\).</p>
<p>Because in <code>unmarked</code> values of <code>NA</code> are typically used to indicate 
missing values that were a result of the sampling structure (e.g., lost data), 
we indicate a censored \(y_i\) in <code>nmixTTD</code> instead by setting 
\(y_i = Tmax_i\) in the <code>y</code> matrix provided to 
<code><a href='unmarkedFrameOccuTTD.html'>unmarkedFrameOccuTTD</a></code>. You can provide either a single value of 
\(Tmax\) to the <code>surveyLength</code> argument of <code>unmarkedFrameOccuTTD</code>, 
or provide a matrix, potentially with a unique value of \(Tmax\) for each 
value of <code>y</code>. Note that in the latter case the value of <code>y</code> that will 
be interpreted by <code>nmixTTD</code> as a censored observation (i.e., \(Tmax\)) 
will differ between observations!</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Strebel, N., Fiss, C., Kellner, K. F., Larkin, J. L., Kery, M., &amp; Cohen, J (2021). 
  Estimating abundance based on time-to-detection data. Methods in Ecology and Evolution 12: 909-920.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Ken Kellner <a href='mailto:contact@kenkellner.com'>contact@kenkellner.com</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='unmarked-package.html'>unmarked</a></code>, <code><a href='unmarkedFrameOccuTTD.html'>unmarkedFrameOccuTTD</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>

<span class='co'># Simulate data</span>
<span class='va'>M</span> <span class='op'>=</span> <span class='fl'>1000</span> <span class='co'># Number of sites</span>
<span class='va'>nrep</span> <span class='op'>&lt;-</span> <span class='fl'>3</span> <span class='co'># Number of visits per site</span>
<span class='va'>Tmax</span> <span class='op'>=</span> <span class='fl'>5</span> <span class='co'># Max duration of a visit</span>
<span class='va'>alpha1</span> <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span> <span class='co'># Covariate on rate</span>
<span class='va'>beta1</span> <span class='op'>=</span> <span class='fl'>1</span> <span class='co'># Covariate on density</span>
<span class='va'>mu.lambda</span> <span class='op'>=</span> <span class='fl'>1</span> <span class='co'># Rate at alpha1 = 0</span>
<span class='va'>mu.dens</span> <span class='op'>=</span> <span class='fl'>1</span> <span class='co'># Density at beta1 = 0</span>

<span class='va'>covDet</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>M</span><span class='op'>*</span><span class='va'>nrep</span><span class='op'>)</span>,nrow <span class='op'>=</span> <span class='va'>M</span>,ncol <span class='op'>=</span> <span class='va'>nrep</span><span class='op'>)</span> <span class='co'>#Detection covariate</span>
<span class='va'>covDens</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>M</span><span class='op'>)</span> <span class='co'>#Abundance/density covariate</span>
<span class='va'>dens</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mu.dens</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>beta1</span> <span class='op'>*</span> <span class='va'>covDens</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>N</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>rpois</a></span><span class='op'>(</span><span class='va'>M</span>, <span class='va'>dens</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Realized density per site</span>
<span class='va'>lambda</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mu.lambda</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>alpha1</span> <span class='op'>*</span> <span class='va'>covDet</span><span class='op'>)</span> <span class='co'># per-individual detection rate</span>
<span class='va'>ttd</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>
<span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>nrep</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>ttd</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>ttd</span>,<span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>rexp</a></span><span class='op'>(</span><span class='va'>M</span>, <span class='va'>N</span><span class='op'>*</span><span class='va'>lambda</span><span class='op'>[</span>,<span class='va'>i</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'># Simulate time to first detection per visit</span>
<span class='op'>}</span>
<span class='va'>ttd</span><span class='op'>[</span><span class='va'>N</span> <span class='op'>==</span> <span class='fl'>0</span>,<span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>5</span> <span class='co'># Not observed where N = 0; ttd set to Tmax</span>
<span class='va'>ttd</span><span class='op'>[</span><span class='va'>ttd</span> <span class='op'>&gt;=</span> <span class='va'>Tmax</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>5</span> <span class='co'># Crop at Tmax</span>

<span class='co'>#Build unmarked frame</span>
<span class='va'>umf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='unmarkedFrameOccuTTD.html'>unmarkedFrameOccuTTD</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>ttd</span>, surveyLength<span class='op'>=</span><span class='fl'>5</span>,
                            siteCovs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>covDens<span class='op'>=</span><span class='va'>covDens</span><span class='op'>)</span>,
                            obsCovs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>covDet<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/as.matrix.html'>as.vector</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/transpose.html'>t</a></span><span class='op'>(</span><span class='va'>covDet</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#Fit model</span>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'>nmixTTD</span><span class='op'>(</span><span class='op'>~</span><span class='va'>covDens</span>, <span class='op'>~</span><span class='va'>covDet</span>, data<span class='op'>=</span><span class='va'>umf</span>, K<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span><span class='op'>+</span><span class='fl'>10</span><span class='op'>)</span>

<span class='co'>#Compare to truth</span>
<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mu.dens</span><span class='op'>)</span>, <span class='va'>beta1</span>, <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mu.lambda</span><span class='op'>)</span>, <span class='va'>alpha1</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#Predict abundance/density values</span>
<span class='fu'><a href='https://rdrr.io/pkg/raster/man/headtail.html'>head</a></span><span class='op'>(</span><span class='fu'><a href='predict-methods.html'>predict</a></span><span class='op'>(</span><span class='va'>fit</span>, type<span class='op'>=</span><span class='st'>'state'</span><span class='op'>)</span><span class='op'>)</span>

<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://chandlerlab.uga.edu/richard-chandler-phd/'>Richard Chandler</a>, <a href='https://kenkellner.com'>Ken Kellner</a>, Ian Fiske, David Miller, Andy Royle, Jeff Hostetler, Rebecca Hutchinson, Adam Smith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


