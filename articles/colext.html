<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic occupancy models in unmarked • unmarked</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Dynamic occupancy models in unmarked">
<meta property="og:description" content="unmarked">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unmarked</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/unmarked.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cap-recap.html">Modeling variation in abundance using capture-recapture data</a>
    </li>
    <li>
      <a href="../articles/colext.html">Dynamic occupancy models in unmarked</a>
    </li>
    <li>
      <a href="../articles/distsamp.html">Distance sampling analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/powerAnalysis.html">Power Analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/simulate.html">Simulating datasets</a>
    </li>
    <li>
      <a href="../articles/spp-dist.html">Modeling and mapping species distributions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rbchan/unmarked/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Dynamic occupancy models in unmarked</h1>
                        <h4 class="author">Marc Kéry, Swiss Ornithological Institute</h4>
                                    <h4 class="author">Richard Chandler, University of Georgia</h4>
                        
            <h4 class="date">August 16, 2016</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rbchan/unmarked/blob/master/vignettes/colext.Rmd"><code>vignettes/colext.Rmd</code></a></small>
      <div class="hidden name"><code>colext.Rmd</code></div>

    </div>

    
    
<div id="abstract" class="section level1">
<h1 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h1>
<p>Dynamic occupancy models <span class="citation">(MacKenzie et al. 2003)</span> allow inference about the occurrence of “things” at collections of “sites” and about how changes in occurrence are driven by colonization and local extinction. These models also account for imperfect detection probability. Depending on how “thing” and “site” are defined, occupancy may have vastly different biological meanings, including the presence of a disease in an individual (disease incidence) of a species at a site (occurrence, distribution), or of an individual in a territory. Dynamic occupancy models in <code>unmarked</code> are fit using the function <code>colext</code>. All parameters can be modeled as functions of covariates, i.e., first-year occupancy with covariates varying by site (site-covariates), colonization and survival with site- and yearly-site-covariates and detection with site-, yearly-site- and sample-occasion-covariates. We give two commented example analyses: one for a simulated data set and another for a real data set on crossbills in the Swiss breeding bird survey MHB. We also give examples to show how predictions, along with standard errors and confidence intervals, can be obtained.</p>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Occurrence is a quantity of central importance in many branches of ecology and related sciences. The presence of a disease in an individual or of a species at a site are two common types of occurrence studies. The associated biological metrics are the incidence of the disease and species occurrence or species distribution. Thus, depending on how we define the thing we are looking for and the sample unit, very different biological quantities can be analyzed using statistical models for occupancy.</p>
<p>If we denote presence of the “thing” as <span class="math inline">\(y=1\)</span> and its absence as <span class="math inline">\(y=0\)</span>, then it is natural to characterize all these metrics by the probability that a randomly chosen sample unit (“site”) is occupied, i.e., has a “thing” present: <span class="math inline">\(Pr(y=1) = \psi\)</span>. We call this the occupancy probability, or occupancy for short, and from now on will call the sample unit, where the presence or absence of a “thing” is assessed, generically a “site”.</p>
<p>Naturally, we would like to explore factors that affect the likelihood that a site is occupied. A binomial generalized linear model, or logistic regression, is the customary statistical model for occurrence. In this model, we treat occurrence <span class="math inline">\(y\)</span> as a binomial random variable with trial size 1 and success probability <span class="math inline">\(p\)</span>, or, equivalently, a Bernoulli trial with <span class="math inline">\(p\)</span>. “Success” means occurrence, so <span class="math inline">\(p\)</span> is the occurrence probability. It can be modeled as a linear or other function of covariates via a suitable link function, e.g., the logit link. This simple model is described in many places, including <span class="citation">McCullagh and Nelder (1989)</span>, Royle and Dorazio <span class="citation">(2008 chap. 3)</span>, Kéry <span class="citation">(2010 chap. 17)</span> and Kéry and Schaub <span class="citation">(2011 chap. 3)</span>.</p>
<p>A generalization of this model accounts for changes in the occupancy state of sites by introducing parameters for survival (or alternatively, extinction) and colonization probability. Thus, when we have observations of occurrence for more than a single point in time, we can model the transition of the occupancy state at site <span class="math inline">\(i\)</span> between successive times as another Bernoulli trial. To model the fate of an occupied site, we denote the probability that a site occupied at <span class="math inline">\(t\)</span> is again occupied at <span class="math inline">\(t+1\)</span> as <span class="math inline">\(Pr(y_{i,t+1} = 1 | y_{i,t} = 1 ) = \phi\)</span>. This represents the survival probability of a site that is occupied. Of course, we could also choose to express this component of occupancy dynamics by the converse, extinction probability <span class="math inline">\(\epsilon\)</span> — the parameterization used in <code>unmarked</code>. To model the fate of an unoccupied site, we denote as <span class="math inline">\(Pr(y_{i,t+1} = 1 | y_{i,t} = 0 ) = \gamma\)</span> the probability that an unoccupied site at <span class="math inline">\(t\)</span> becomes occupied at <span class="math inline">\(t+1\)</span>. This is the colonization probability of an empty site. Such a dynamic model of occurrence has become famous in the ecological literature under the name “metapopulation model” <span class="citation">(Hanski 1998)</span>.</p>
<p>However, when using ecological data collected in the field to fit such models of occurrence, we face the usual challenge of imperfect detection <span class="citation">(e.g. Kéry and Schmidt 2008)</span>. For instance, a species can go unobserved at a surveyed site or an occupied territory can appear unoccupied during a particular survey, perhaps because both birds are away hunting. Not accounting for detection error may seriously bias all parameter estimators of a metapopulation model <span class="citation">(Moilanen 2002, Royle and Dorazio 2008)</span>. To account for this additional stochastic component in the generation of most ecological field data, the classical metapopulation model may be generalized to include a submodel for the observation process, which allows an occupied site to be recorded as unoccupied. This model has been developed by <span class="citation">MacKenzie et al. (2003)</span>. It is described as a hierarchical model by <span class="citation">Royle (2007)</span>, Royle and Dorazio <span class="citation">(2008 chap. 9)</span> and Kéry and Schaub <span class="citation">(2011 chap. 13)</span>. The model is usually called a multi-season, multi-year or a dynamic site-occupancy model. The former terms denote the fact that it is applied to multiple “seasons” or years and the latter emphasizes that the model allows for between-season occurrence dynamics.</p>
<p>This vignette describes the use of the <code>unmarked</code> function <code>colext</code> to fit dynamic occupancy models. Note that we will use italics for the names of functions. Static occupancy models, i.e., for a single season without changes in the occupancy state <span class="citation">(MacKenzie et al. 2002)</span>, can be fit with <code>occu</code>, for the model described by <span class="citation">MacKenzie et al. (2002)</span> and <span class="citation">Tyre et al. (2003)</span>, and with <code>occuRN</code>, for the heterogeneity occupancy model described by <span class="citation">Royle and Nichols (2003)</span>. In the next section (section 2), we give a more technical description of the dynamic occupancy model. In section 3, we provide R code for generating data under a basic dynamic occupancy model and illustrate use of <code>colext</code> for fitting the model. In section 4, we use real data from the Swiss breeding bird survey MHB <span class="citation">(Schmid et al. 2004)</span> to fit a few more elaborate models with covariates for all parameters. We also give examples illustrating how to compute predictions, with standard errors and 95% confidence intervals, for the parameters.</p>
</div>
<div id="dynamic-occupancy-models" class="section level1">
<h1 class="hasAnchor">
<a href="#dynamic-occupancy-models" class="anchor"></a>Dynamic occupancy models</h1>
<p>To be able to estimate the parameters of the dynamic occupancy model (probabilities of occurrence, survival and colonization) separately from the parameters for the observation process (detection probability), replicate observations are required from a period of closure, during which the occupancy state of a site must remain constant, i.e., it is either occupied or unoccupied. The modeled data <span class="math inline">\(y_{ijt}\)</span> are indicators for whether a species is detected at site <span class="math inline">\(i\)</span> (<span class="math inline">\(i = 1, 2, \ldots M\)</span>), during replicate survey <span class="math inline">\(j\)</span> (<span class="math inline">\(j = 1, 2, \ldots J\)</span>) in season <span class="math inline">\(t\)</span> (<span class="math inline">\(t = 1, 2, \ldots T\)</span>). That is, <span class="math inline">\(y_{ijt}=1\)</span> if at least one individual is detected and <span class="math inline">\(y_{ijt}=0\)</span> if none is detected.</p>
<p>The model makes the following assumptions: * replicate surveys at a site during a single season are independent (or else dependency must be modeled) * occurrence state <span class="math inline">\(z_{it}\)</span> (see below) does not change over replicate surveys at site <span class="math inline">\(i\)</span> during season <span class="math inline">\(t\)</span> * there are no false-positive errors, i.e., a species can only be overlooked where it occurs, but it cannot be detected where it does not in fact occur (i.e., there are no false-positives)</p>
<p>The complete model consists of one submodel to describe the ecological process, or state, and another submodel for the observation process, which is dependent on the result of the ecological process. The ecological process describes the latent occurrence dynamics for all sites in terms of parameters for the probability of initial occurrence and site survival and colonization. The observation process describes the probability of detecting a presence (i.e., <span class="math inline">\(y = 1\)</span>) at a site that is occupied and takes account of false-negative observation errors.</p>
<div id="ecological-or-state-process" class="section level2">
<h2 class="hasAnchor">
<a href="#ecological-or-state-process" class="anchor"></a>Ecological or state process</h2>
<p>This initial state is denoted <span class="math inline">\(z_{i1}\)</span> and represents occurrence at site <span class="math inline">\(i\)</span> during season 1. For this, the model assumes a Bernoulli trial governed by the occupancy probability in the first season <span class="math inline">\(\psi_{i1}\)</span>:</p>
<p><span class="math display">\[
z_{i1} = Bernoulli(\psi_{i1})
\]</span></p>
<p>We must distinguish the sample quantity “occurrence” at a site, <span class="math inline">\(z\)</span>, from the population quantity “occupancy probability”, <span class="math inline">\(\psi\)</span>. The former is the realization of a Bernoulli random variable with parameter <span class="math inline">\(\psi\)</span>. This distinction becomes important when we want to compute the number of occupied sites among the sample of surveyed sites; see <span class="citation">Royle (2007)</span> and <span class="citation">Weir and Royle (2009)</span> for this distinction.</p>
<p>For all later seasons (<span class="math inline">\(t = 2, 3, \ldots T\)</span>), occurrence is a function of occurrence at site <span class="math inline">\(i\)</span> at time <span class="math inline">\(t-1\)</span> and one of two parameters that describe the colonization-extinction dynamics of the system. These dynamic parameters are the probability of local survival <span class="math inline">\(\phi_{it}\)</span>, also called probability of persistence (= 1 minus the probability of local extinction), and the probability of colonization <span class="math inline">\(\gamma_{it}\)</span>.</p>
<p><span class="math display">\[
z_{it} \sim Bernoulli(z_{i,t-1} \phi_{it} + (1-z_{i,t-1}) \gamma_{it})
\]</span></p>
<p>Hence, if site <span class="math inline">\(i\)</span> is unoccupied at <span class="math inline">\(t-1\)</span> , <span class="math inline">\(z_{i,t-1}=0\)</span>, and the success probability of the Bernoulli is <span class="math inline">\(0*\phi_{it} + (1-0) * \gamma_{it}\)</span>, so the site is occupied (=colonized) in season <span class="math inline">\(t\)</span> with probability <span class="math inline">\(\gamma_{it}\)</span> . Conversely, if site <span class="math inline">\(i\)</span> is occupied at <span class="math inline">\(t-1\)</span> , <span class="math inline">\(z_{i,t-1}=1\)</span>, and the success probability of the Bernoulli is given by <span class="math inline">\(1*\phi_{it} + (1-1) * \gamma_{it}\)</span>, so the site is occupied in (=survives to) season <span class="math inline">\(t\)</span> with probability <span class="math inline">\(\phi_{it}\)</span>.</p>
<p>Occupancy probability (<span class="math inline">\(\psi_{it}\)</span>) and occurrence (<span class="math inline">\(z_{it}\)</span>) at all later times <span class="math inline">\(t\)</span> can be computed recursively from <span class="math inline">\(\psi_{i1}\)</span>, <span class="math inline">\(z_{i1}\)</span> , <span class="math inline">\(\phi_{it}\)</span> and <span class="math inline">\(\gamma_{it}\)</span>. Variances of these derived estimates can be obtained via the delta method or the bootstrap.</p>
</div>
<div id="observation-process" class="section level2">
<h2 class="hasAnchor">
<a href="#observation-process" class="anchor"></a>Observation process</h2>
<p>To account for the observation error (specifically, false-negative observations), the conventional Bernoulli detection process is assumed, such that</p>
<p><span class="math display">\[
y_{ijt} \sim Bernoulli(z_{it} p_{ijt})
\]</span></p>
<p>Here, <span class="math inline">\(y_{ijt}\)</span> is the detection probability at site <span class="math inline">\(i\)</span> during survey <span class="math inline">\(j\)</span> and season <span class="math inline">\(t\)</span>. Detection is conditional on occurrence, and multiplying <span class="math inline">\(p_{ijt}\)</span> with <span class="math inline">\(z_{it}\)</span> ensures that occurrence can only be detected where in fact a species occurs, i.e. where <span class="math inline">\(z_{it}=1\)</span>.</p>
</div>
<div id="modeling-of-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#modeling-of-parameters" class="anchor"></a>Modeling of parameters</h2>
<p>The preceding, fully general model description allows for site-(<span class="math inline">\(i\)</span>) dependence of all parameters. In addition to that, survival and colonization probabilities may be season-(<span class="math inline">\(t\)</span>)dependent and detection probability season-(<span class="math inline">\(t\)</span>) and survey-(<span class="math inline">\(j\)</span>) dependent. All this complexity may be dropped, especially the dependence on sites. On the other hand, all parameters that are indexed in some way can be modeled, e.g., as functions of covariates that vary along the dimension denoted by an index. We will fit linear functions (on the logit link scale) of covariates into first-year occupancy, survival and colonization and into detection probability. That is, for probabilities of first-year occupancy, survival, colonization and detection, respectively, we will fit models of the form <span class="math inline">\(logit(\psi_{i1}) = \alpha + \beta x_i\)</span>, where <span class="math inline">\(x_i\)</span> may be forest cover or elevation of site <span class="math inline">\(i\)</span> , <span class="math inline">\(logit(\phi_{it}) = \alpha + \beta x_{it}\)</span>, where <span class="math inline">\(x_{it}\)</span> may be tree mast at site <span class="math inline">\(i\)</span> during season <span class="math inline">\(t\)</span>, <span class="math inline">\(logit(\gamma_{it}) = \alpha + \beta x_{it}\)</span>, for a similarly defined covariate <span class="math inline">\(x_{it}\)</span>, or <span class="math inline">\(logit(p_{ijt}) = \alpha + \beta x_{ijt}\)</span> , where <span class="math inline">\(x_{ijt}\)</span> is the Julian date of the survey <span class="math inline">\(j\)</span> at site <span class="math inline">\(i\)</span> in season <span class="math inline">\(t\)</span>.</p>
<p>We note that for first-year occupancy, only covariates that vary among sites (“site covariates”) can be fitted, while for survival and colonization, covariates that vary by site and by season (“yearly site covariates”) may be fitted as well. For detection, covariates of three formats may be fitted: “site-covariates”, “yearly-site-covariates” and “observation-covariates”, as they are called in <code>unmarked</code>.</p>
</div>
</div>
<div id="dynamic-occupancy-models-for-simulated-data" class="section level1">
<h1 class="hasAnchor">
<a href="#dynamic-occupancy-models-for-simulated-data" class="anchor"></a>Dynamic occupancy models for simulated data</h1>
<p>We first generate a simple, simulated data set with specified, year-specific values for the parameters as well as design specifications, i.e., number of sites, years and surveys per year. Then, we show how to fit a dynamic occupancy model with year-dependence in the parameters for colonization, extinction and detection probability.</p>
<div id="simulating-formatting-and-summarizing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-formatting-and-summarizing-data" class="anchor"></a>Simulating, formatting, and summarizing data</h2>
<p>To simulate the data, we execute the following R code. The actual values for these parameters for each year are drawn randomly from a uniform distribution with the specified bounds.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="va">M</span> <span class="op">&lt;-</span> <span class="fl">250</span>                                <span class="co"># Number of sites</span>
<span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">3</span>                                  <span class="co"># num secondary sample periods</span>
<span class="cn">T</span> <span class="op">&lt;-</span> <span class="fl">10</span>                                 <span class="co"># num primary sample periods</span>

<span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">T</span><span class="op">)</span>                       <span class="co"># Occupancy probability</span>
<span class="va">muZ</span> <span class="op">&lt;-</span> <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">M</span>, <span class="cn">T</span><span class="op">)</span><span class="op">)</span>        <span class="co"># Expected and realized occurrence</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">M</span>, <span class="va">J</span>, <span class="cn">T</span><span class="op">)</span><span class="op">)</span>        <span class="co"># Detection histories</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">13973</span><span class="op">)</span>
<span class="va">psi</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.4</span>                           <span class="co"># Initial occupancy probability</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.6</span>,<span class="fl">0.2</span><span class="op">)</span>
<span class="va">phi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="cn">T</span><span class="op">-</span><span class="fl">1</span>, min<span class="op">=</span><span class="fl">0.6</span>, max<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>   <span class="co"># Survival probability (1-epsilon)</span>
<span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="cn">T</span><span class="op">-</span><span class="fl">1</span>, min<span class="op">=</span><span class="fl">0.1</span>, max<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="co"># Colonization probability</span>

<span class="co"># Generate latent states of occurrence</span>
<span class="co"># First year</span>
<span class="va">z</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">M</span>, <span class="fl">1</span>, <span class="va">psi</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>           <span class="co"># Initial occupancy state</span>
<span class="co"># Later years</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">M</span><span class="op">)</span><span class="op">{</span>                          <span class="co"># Loop over sites</span>
   <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="cn">T</span><span class="op">)</span><span class="op">{</span>                        <span class="co"># Loop over years</span>
      <span class="va">muZ</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">phi</span><span class="op">[</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">gamma</span><span class="op">[</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
      <span class="va">z</span><span class="op">[</span><span class="va">i</span>,<span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">muZ</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>
   <span class="op">}</span>
<span class="op">}</span>

<span class="co"># Generate detection/non-detection data</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">M</span><span class="op">)</span><span class="op">{</span>
   <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="cn">T</span><span class="op">)</span><span class="op">{</span>
      <span class="va">prob</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[</span><span class="va">i</span>,<span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">p</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>
      <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
         <span class="va">y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">prob</span><span class="op">)</span>
      <span class="op">}</span>
   <span class="op">}</span>
<span class="op">}</span>

<span class="co"># Compute annual population occupancy</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="cn">T</span><span class="op">)</span><span class="op">{</span>
   <span class="va">psi</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">psi</span><span class="op">[</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">phi</span><span class="op">[</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">psi</span><span class="op">[</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">gamma</span><span class="op">[</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
   <span class="op">}</span></pre></div>
<p>We have now generated a single realization from the stochastic system thus defined. Figure 1 illustrates the fundamental issue of imperfect detection — the actual proportion of sites occupied differs greatly from the observed proportion of sites occupied, and because <span class="math inline">\(p\)</span> varies among years, the observed data cannot be used as a valid index of the parameter of interest <span class="math inline">\(\psi_i\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="cn">T</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"b"</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>,
     ylab <span class="op">=</span> <span class="st">"Proportion of sites occupied"</span>,
     col <span class="op">=</span> <span class="st">"black"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">10.5</span><span class="op">)</span>, xaxp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">9</span><span class="op">)</span>,
     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.6</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">1</span>,
     frame.plot <span class="op">=</span> <span class="cn">FALSE</span>, las <span class="op">=</span> <span class="fl">1</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span>

<span class="va">psi.app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, <span class="va">max</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="cn">T</span>, <span class="va">psi.app</span>, type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lty<span class="op">=</span><span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.6</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"truth"</span>, <span class="st">"observed"</span><span class="op">)</span>,
       col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></pre></div>
<div class="figure">
<img src="colext-data-1.png" alt="Figure 1. Summary of the multi-year occupancy data set generated."><p class="caption">Figure 1. Summary of the multi-year occupancy data set generated.</p>
</div>
<p>To analyze this data set with a dynamic occupancy model in <code>unmarked</code>, we first load the package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://groups.google.com/d/forum/unmarked">unmarked</a></span><span class="op">)</span></pre></div>
<p>Next, we reformat the detection/non-detection data from a 3-dimensional array (as generated) into a 2-dimensional matrix with M rows. That is, we put the annual tables of data (the slices of the former 3-D array) sideways to produce a “wide” layout of the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">yy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">M</span>, <span class="va">J</span><span class="op">*</span><span class="cn">T</span><span class="op">)</span></pre></div>
<p>Next, we create a matrix indicating the year each site was surveyed.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'01'</span>,<span class="st">'02'</span>,<span class="st">'03'</span>,<span class="st">'04'</span>,<span class="st">'05'</span>,<span class="st">'06'</span>,<span class="st">'07'</span>,<span class="st">'08'</span>,<span class="st">'09'</span>,<span class="st">'10'</span><span class="op">)</span>,
               <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">yy</span><span class="op">)</span>, <span class="cn">T</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></pre></div>
<p>To organize the data in the format required by <code>colext</code>, we make use of the function <code>unmarkedMultFrame</code>. The only required arguments are <code>y</code>, the detection/non-detection data, and <code>numPrimary</code>, the number of seasons. The three types of covariates described earlier can also be supplied using the arguments <code>siteCovs</code>, <code>yearlySiteCovs</code>, and <code>obsCovs</code>. In this case, we only make use of the second type, which must have M rows and T columns.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">simUMF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedMultFrame.html">unmarkedMultFrame</a></span><span class="op">(</span>
    y <span class="op">=</span> <span class="va">yy</span>,
    yearlySiteCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span><span class="op">)</span>,
    numPrimary<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">simUMF</span><span class="op">)</span></pre></div>
<pre><code>## unmarkedFrame Object
## 
## 250 sites
## Maximum number of observations per site: 30 
## Mean number of observations per site: 30 
## Number of primary survey periods: 10 
## Number of secondary survey periods: 3 
## Sites with at least one detection: 195 
## 
## Tabulation of y observations:
##    0    1 
## 6430 1070 
## 
## Yearly-site-level covariates:
##       year     
##  01     : 250  
##  02     : 250  
##  03     : 250  
##  04     : 250  
##  05     : 250  
##  06     : 250  
##  (Other):1000</code></pre>
</div>
<div id="model-fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting" class="anchor"></a>Model fitting</h2>
<p>We are ready to fit a few dynamic occupancy models. We will fit a model with constant values for all parameters and another with full time-dependence for colonization, extinction and detection probability. We also time the calculations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># Model with all constant parameters</span>
<span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colext.html">colext</a></span><span class="op">(</span>psiformula<span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, gammaformula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, epsilonformula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,
             pformula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">simUMF</span>, method<span class="op">=</span><span class="st">"BFGS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m0</span><span class="op">)</span></pre></div>
<pre><code>## 
## Call:
## colext(psiformula = ~1, gammaformula = ~1, epsilonformula = ~1, 
##     pformula = ~1, data = simUMF, method = "BFGS")
## 
## Initial (logit-scale):
##  Estimate    SE     z  P(&gt;|z|)
##    -0.813 0.158 -5.16 2.46e-07
## 
## Colonization (logit-scale):
##  Estimate     SE   z   P(&gt;|z|)
##     -1.77 0.0807 -22 2.75e-107
## 
## Extinction (logit-scale):
##  Estimate    SE     z  P(&gt;|z|)
##     -0.59 0.102 -5.79 7.04e-09
## 
## Detection (logit-scale):
##  Estimate     SE     z P(&gt;|z|)
##   -0.0837 0.0562 -1.49   0.137
## 
## AIC: 4972.597 
## Number of sites: 250
## optim convergence code: 0
## optim iterations: 27 
## Bootstrap iterations: 0</code></pre>
<p>The computation time was only a few seconds. Note that all parameters were estimated on the logit scale. To back-transform to the original scale, we can simply use the inverse-logit function, named <code>plogis</code> in R.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.813</span><span class="op">)</span></pre></div>
<pre><code>## [1] 0.3072516</code></pre>
<p>Alternatively, we can use <code>backTransform</code>, which computes standard errors using the delta method. Confidence intervals are also easily obtained using the function <code>confint</code>. We first remind ourselves of the names of parameters, which can all be used as arguments for these functions.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">m0</span><span class="op">)</span></pre></div>
<pre><code>## [1] "psi" "col" "ext" "det"</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="fu"><a href="../reference/backTransform-methods.html">backTransform</a></span><span class="op">(</span><span class="va">m0</span>, type<span class="op">=</span><span class="st">"psi"</span><span class="op">)</span></pre></div>
<pre><code>## Backtransformed linear combination(s) of Initial estimate(s)
## 
##  Estimate     SE LinComb (Intercept)
##     0.307 0.0335  -0.813           1
## 
## Transformation: logistic</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="fu"><a href="../reference/backTransform-methods.html">backTransform</a></span><span class="op">(</span><span class="va">m0</span>, type<span class="op">=</span><span class="st">"psi"</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##      0.025     0.975
##  0.2457313 0.3765804</code></pre>
<p>Next, we fit the dynamic occupancy model with full year-dependence in the parameters describing occupancy dynamics and also in detection. This is the same model under which we generated the data set, so we would expect accurate estimates.</p>
<p>By default in R, a factor such as year in this analysis, is a parameterized in terms of an intercept and effects representing differences. This would mean that the parameter for the first year is the intercept and the effects would denote the differences between the parameter values in all other years, relative to the parameter value in the first year, which serves as a reference level. This treatment or effects parameterization is useful for testing for differences. For simple presentation, a means parameterization is more practical. It can be specified by adding a -1 to the formula for the time-dependent parameters.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colext.html">colext</a></span><span class="op">(</span>psiformula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,   <span class="co"># First-year occupancy</span>
    gammaformula <span class="op">=</span> <span class="op">~</span> <span class="va">year</span><span class="op">-</span><span class="fl">1</span>,    <span class="co"># Colonization</span>
    epsilonformula <span class="op">=</span> <span class="op">~</span> <span class="va">year</span><span class="op">-</span><span class="fl">1</span>,  <span class="co"># Extinction</span>
    pformula <span class="op">=</span> <span class="op">~</span> <span class="va">year</span><span class="op">-</span><span class="fl">1</span>,        <span class="co"># Detection</span>
    data <span class="op">=</span> <span class="va">simUMF</span><span class="op">)</span>
<span class="va">m1</span></pre></div>
<pre><code>## 
## Call:
## colext(psiformula = ~1, gammaformula = ~year - 1, epsilonformula = ~year - 
##     1, pformula = ~year - 1, data = simUMF)
## 
## Initial:
##  Estimate    SE      z P(&gt;|z|)
##    -0.273 0.302 -0.906   0.365
## 
## Colonization:
##        Estimate    SE     z  P(&gt;|z|)
## year01    -2.08 0.951 -2.19 2.86e-02
## year02    -2.18 0.365 -5.96 2.52e-09
## year03    -1.98 0.274 -7.23 4.88e-13
## year04    -2.32 0.678 -3.42 6.37e-04
## year05    -1.89 0.478 -3.95 7.78e-05
## year06    -1.76 0.294 -5.97 2.44e-09
## year07    -1.55 0.230 -6.73 1.75e-11
## year08    -1.43 0.228 -6.29 3.19e-10
## year09    -2.35 0.470 -5.00 5.64e-07
## 
## Extinction:
##        Estimate    SE      z  P(&gt;|z|)
## year01  -1.4209 0.418 -3.401 6.72e-04
## year02  -0.4808 0.239 -2.009 4.45e-02
## year03  -1.2606 0.366 -3.440 5.83e-04
## year04  -0.0907 0.650 -0.139 8.89e-01
## year05  -0.6456 0.599 -1.078 2.81e-01
## year06  -0.9586 0.378 -2.539 1.11e-02
## year07  -1.2279 0.365 -3.362 7.74e-04
## year08  -1.1894 0.292 -4.076 4.58e-05
## year09  -0.6292 0.635 -0.991 3.22e-01
## 
## Detection:
##        Estimate    SE      z  P(&gt;|z|)
## year01  -1.0824 0.244 -4.434 9.26e-06
## year02  -0.2232 0.148 -1.508 1.32e-01
## year03   0.2951 0.154  1.918 5.52e-02
## year04   0.0662 0.161  0.412 6.81e-01
## year05  -2.0396 0.433 -4.706 2.52e-06
## year06  -0.6982 0.232 -3.005 2.66e-03
## year07   0.2413 0.165  1.466 1.43e-01
## year08   0.0847 0.155  0.548 5.84e-01
## year09   0.6052 0.140  4.338 1.44e-05
## year10  -1.1699 0.306 -3.828 1.29e-04
## 
## AIC: 4779.172</code></pre>
</div>
<div id="manipulating-results-prediction-and-plotting" class="section level2">
<h2 class="hasAnchor">
<a href="#manipulating-results-prediction-and-plotting" class="anchor"></a>Manipulating results: prediction and plotting</h2>
<p>Again, all estimates are shown on the logit-scale. Back-transforming estimates when covariates, such as year, are present involves an extra step. Specifically, we need to tell <code>unmarked</code> the values of our covariate at which we want an estimate. This can be done using <code>backTransform</code> in combination with <code>linearComb</code>, although it can be easier to use <code>predict</code>. <code>predict</code> allows the user to supply a data.frame in which each row represents a combination of covariate values of interest. Below, we create data.frames called <code>nd</code> with each row representing a year. Then we request yearly estimates of the probability of extinction, colonization and detection, and compare them to “truth”, i.e., the values with which we simulated the data set. Note that there are T-1 extinction and colonization parameters in this case, so we do not need to include year 10 in <code>nd</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>year<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'01'</span>,<span class="st">'02'</span>,<span class="st">'03'</span>,<span class="st">'04'</span>,<span class="st">'05'</span>,<span class="st">'06'</span>,<span class="st">'07'</span>,<span class="st">'08'</span>,<span class="st">'09'</span><span class="op">)</span><span class="op">)</span>
<span class="va">E.ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict-methods.html">predict</a></span><span class="op">(</span><span class="va">m1</span>, type<span class="op">=</span><span class="st">'ext'</span>, newdata<span class="op">=</span><span class="va">nd</span><span class="op">)</span>
<span class="va">E.col</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict-methods.html">predict</a></span><span class="op">(</span><span class="va">m1</span>, type<span class="op">=</span><span class="st">'col'</span>, newdata<span class="op">=</span><span class="va">nd</span><span class="op">)</span>
<span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>year<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'01'</span>,<span class="st">'02'</span>,<span class="st">'03'</span>,<span class="st">'04'</span>,<span class="st">'05'</span>,<span class="st">'06'</span>,<span class="st">'07'</span>,<span class="st">'08'</span>,<span class="st">'09'</span>,<span class="st">'10'</span><span class="op">)</span><span class="op">)</span>
<span class="va">E.det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict-methods.html">predict</a></span><span class="op">(</span><span class="va">m1</span>, type<span class="op">=</span><span class="st">'det'</span>, newdata<span class="op">=</span><span class="va">nd</span><span class="op">)</span></pre></div>
<p><code>predict</code> returns the predictions along with standard errors and confidence intervals. These can be used to create plots. The <code>with</code> function is used to simplify the process of requesting the columns of <code>data.frame</code> returned by <code>predict</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.6</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">E.ext</span>, <span class="op">{</span>   <span class="co"># Plot for extinction probability</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="va">Predicted</span>, pch<span class="op">=</span><span class="fl">1</span>, xaxt<span class="op">=</span><span class="st">'n'</span>, xlab<span class="op">=</span><span class="st">'Year'</span>,
    ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'Extinction probability ( '</span>, <span class="va">epsilon</span>, <span class="st">' )'</span><span class="op">)</span><span class="op">)</span>,
    ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, labels<span class="op">=</span><span class="va">nd</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="va">lower</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="va">upper</span>, code<span class="op">=</span><span class="fl">3</span>, angle<span class="op">=</span><span class="fl">90</span>, length<span class="op">=</span><span class="fl">0.03</span>, col<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1</span><span class="op">-</span><span class="va">phi</span>, col<span class="op">=</span><span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Parameter'</span>, <span class="st">'Estimate'</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>, pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">1</span><span class="op">)</span>,
         cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">E.col</span>, <span class="op">{</span>   <span class="co"># Plot for colonization probability</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="va">Predicted</span>, pch<span class="op">=</span><span class="fl">1</span>, xaxt<span class="op">=</span><span class="st">'n'</span>, xlab<span class="op">=</span><span class="st">'Year'</span>,
    ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'Colonization probability ( '</span>, <span class="va">gamma</span>, <span class="st">' )'</span><span class="op">)</span><span class="op">)</span>,
    ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, labels<span class="op">=</span><span class="va">nd</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="va">lower</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="va">upper</span>, code<span class="op">=</span><span class="fl">3</span>, angle<span class="op">=</span><span class="fl">90</span>, length<span class="op">=</span><span class="fl">0.03</span>, col<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">-</span><span class="fl">0.1</span>, <span class="va">gamma</span>, col<span class="op">=</span><span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Parameter'</span>, <span class="st">'Estimate'</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>, pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">1</span><span class="op">)</span>,
         cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">E.det</span>, <span class="op">{</span>   <span class="co"># Plot for detection probability: note 10 years</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">Predicted</span>, pch<span class="op">=</span><span class="fl">1</span>, xaxt<span class="op">=</span><span class="st">'n'</span>, xlab<span class="op">=</span><span class="st">'Year'</span>,
    ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'Detection probability ( '</span>, <span class="va">p</span>, <span class="st">' )'</span><span class="op">)</span><span class="op">)</span>,
    ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, labels<span class="op">=</span><span class="va">nd</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">lower</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">upper</span>, code<span class="op">=</span><span class="fl">3</span>, angle<span class="op">=</span><span class="fl">90</span>, length<span class="op">=</span><span class="fl">0.03</span>, col<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">-</span><span class="fl">0.1</span>, <span class="va">p</span>, col<span class="op">=</span><span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">7.5</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Parameter'</span>,<span class="st">'Estimate'</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>, pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">1</span><span class="op">)</span>,
         cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span></pre></div>
<div class="figure">
<img src="colext-est-1.png" alt="Figure 2. Yearly estimates of parameters"><p class="caption">Figure 2. Yearly estimates of parameters</p>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></pre></div>
<p>Figure 2 shows that the 95% confidence intervals include the true parameter values, and the point estimates are not too far off.</p>
</div>
<div id="derived-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#derived-parameters" class="anchor"></a>Derived parameters</h2>
<p>Estimates of occupancy probability in years <span class="math inline">\(T&gt;1\)</span> must be derived from the estimates of first-year occupancy and the two parameters governing the dynamics, extinction/survival and colonization. <code>unmarked</code> does this automatically in two ways. First, the population-level estimates of occupancy probability <span class="math inline">\(\psi_t = \psi_{t-1}\phi_{t-1} + (1-\phi_{t-1})\gamma\)</span> are calculated and stored in the slot named . Slots can be accessed using the <code><a href="https://rdrr.io/r/base/slotOp.html">@</a></code> operator, e.g. <code>fm@projected</code>. In some cases, interest may lie in making inference about the proportion of the sampled sites that are occupied, rather than the entire population of sites. These estimates are contained in the <code>smoothed</code> slot of the fitted model. Thus, the <code>projected</code> values are estimates of population parameters, and the <code>smoothed</code> estimates are of the finite-sample quantities. Discussions of the differences can be found in <span class="citation">Weir and Royle (2009)</span>.</p>
<p>Bootstrap methods can be used to compute standard errors of derived parameter estimates. Here we employ a non-parametric bootstrap to obtain standard errors of the smoothed estimates of occupancy probability during each year.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nonparboot-methods.html">nonparboot</a></span><span class="op">(</span><span class="va">m1</span>, B <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>psi<span class="op">=</span><span class="va">psi</span>, smoothed<span class="op">=</span><span class="fu"><a href="../reference/unmarkedFit-class.html">smoothed</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>, SE<span class="op">=</span><span class="va">m1</span><span class="op">@</span><span class="va">smoothed.mean.bsse</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>##          psi  smoothed         SE
## 1  0.4000000 0.4320671 0.06783911
## 2  0.3493746 0.4110124 0.03786402
## 3  0.2977125 0.3139967 0.02780818
## 4  0.3148447 0.3278179 0.04303542
## 5  0.3192990 0.2316695 0.10858419
## 6  0.2915934 0.2528485 0.04179036
## 7  0.3114415 0.2928429 0.03113920
## 8  0.3636580 0.3504885 0.04224678
## 9  0.3654064 0.3936991 0.02103870
## 10 0.3460641 0.3095786 0.06830698</code></pre>
<p>In practice, <code>B</code> should be much higher, possibly &gt;1000 for complex models .</p>
<p>Another derived parameters of interest is turnover probability</p>
<p><span class="math display">\[
\tau_t = \frac{\gamma_{t-1}(1-\psi_{t-1})}{\gamma_{t-1}(1-\psi_{t-1})
  + \phi_{t-1}\psi_{t-1}}
\]</span></p>
<p>The following function returns these estimates.</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="va">turnover</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fm</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">psi.hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fm</span>, type<span class="op">=</span><span class="st">"psi"</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">psi.hat</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"this function only works if psi is scalar"</span><span class="op">)</span>
    <span class="cn">T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFit-class.html">getData</a></span><span class="op">(</span><span class="va">fm</span><span class="op">)</span><span class="op">@</span><span class="va">numPrimary</span>
    <span class="va">tau.hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="cn">T</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
    <span class="va">gamma.hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fm</span>, type<span class="op">=</span><span class="st">"col"</span><span class="op">)</span><span class="op">)</span>
    <span class="va">phi.hat</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fm</span>, type<span class="op">=</span><span class="st">"ext"</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">gamma.hat</span><span class="op">)</span> <span class="op">!=</span> <span class="cn">T</span><span class="op">-</span><span class="fl">1</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">phi.hat</span><span class="op">)</span> <span class="op">!=</span> <span class="cn">T</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"this function only works if gamma and phi T-1 vectors"</span><span class="op">)</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="cn">T</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">psi.hat</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">psi.hat</span><span class="op">[</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">phi.hat</span><span class="op">[</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span>
            <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">psi.hat</span><span class="op">[</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">gamma.hat</span><span class="op">[</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
        <span class="va">tau.hat</span><span class="op">[</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gamma.hat</span><span class="op">[</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">psi.hat</span><span class="op">[</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">psi.hat</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>
        <span class="op">}</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tau.hat</span><span class="op">)</span>
    <span class="op">}</span></pre></div>
<p>The bootstrap again offers a means of estimating variance. Here we show how to generate 95% confidence intervals for the turnover estimates using the parametric bootstrap.</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parboot.html">parboot</a></span><span class="op">(</span><span class="va">m1</span>, statistic<span class="op">=</span><span class="va">turnover</span>, nsim<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">turnCI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pb</span><span class="op">@</span><span class="va">t0</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pb</span><span class="op">@</span><span class="va">t.star</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">turnCI</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tau"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span>
<span class="va">turnCI</span></pre></div>
<pre><code>##           tau      lower     upper
## t*1 0.1532645 0.00536045 0.1974714
## t*2 0.1911530 0.07881180 0.2119585
## t*3 0.2537292 0.19777204 0.2785973
## t*4 0.2604356 0.04063769 0.4197328
## t*5 0.3989303 0.34078483 0.4720357
## t*6 0.3758690 0.32703698 0.5370796
## t*7 0.3537473 0.32696166 0.3564059
## t*8 0.3174983 0.32925238 0.4139696
## t*9 0.1704449 0.18946470 0.3186236</code></pre>
<p>Which bootstrap method is most appropriate for variance estimation? For detailed distinctions between the non-parametric and the parametric bootstrap, see <span class="citation">Davison and Hinkley (1997)</span>. We note simply that the parametric bootstrap resamples from the fitted model, and thus the measures of uncertainty are purely functions of the distributions assumed by the model. Non-parametric bootstrap samples, in contrast, are obtained by resampling the data, not the model, and thus are not necessarily affected by the variance formulas of the model’s distributions.</p>
</div>
<div id="goodness-of-fit" class="section level2">
<h2 class="hasAnchor">
<a href="#goodness-of-fit" class="anchor"></a>Goodness-of-fit</h2>
<p>In addition to estimating the variance of an estimate, the parametric bootstrap can be used to assess goodness-of-fit. For this purpose, a fit-statistic, i.e. one that compares observed and expected values, is evaluated using the original fitted model, and numerous other models fitted to simulated datasets. The simulation yields an approximation of the distribution of the fit-statistic, and a -value can be computed as the proportion of simulated values greater than the observed value.</p>
<p><span class="citation">Hosmer et al. (1997)</span> found that a <span class="math inline">\(\chi^2\)</span> statistic performed reasonably well in assessing lack of fit for logistic regression models. We know of no studies formally evaluating the performance of various fit-statistics for dynamic occupancy models, so this approach should be considered experimental. Fit-statistics applied to aggregated encounter histories offer an alternative approach <span class="citation">(MacKenzie and Bailey 2004)</span>, but are difficult to implement when J*T is high and missing values or continuous covariates are present.</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="va">chisq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fm</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">umf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFit-class.html">getData</a></span><span class="op">(</span><span class="va">fm</span><span class="op">)</span>
    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrame-class.html">getY</a></span><span class="op">(</span><span class="va">umf</span><span class="op">)</span>
    <span class="va">sr</span> <span class="op">&lt;-</span> <span class="va">fm</span><span class="op">@</span><span class="va">sitesRemoved</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sr</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span>
        <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="op">-</span><span class="va">sr</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>
    <span class="va">fv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">fm</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fv</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span><span class="op">-</span><span class="va">fv</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="va">fv</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fv</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">344</span><span class="op">)</span>
<span class="va">pb.gof</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parboot.html">parboot</a></span><span class="op">(</span><span class="va">m0</span>, statistic<span class="op">=</span><span class="va">chisq</span>, nsim<span class="op">=</span><span class="fl">100</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">pb.gof</span>, xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">chi</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span>,
     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7300</span>, <span class="fl">7700</span><span class="op">)</span><span class="op">)</span></pre></div>
<div class="figure">
<img src="colext-gof-1.png" alt="Figure 3. Goodness-of-fit"><p class="caption">Figure 3. Goodness-of-fit</p>
</div>
<p>Figure 3 indicates that, as expected, the constant parameter model does not fit the data well.</p>
</div>
</div>
<div id="dynamic-occupancy-models-for-crossbill-data-from-the-swiss-mhb" class="section level1">
<h1 class="hasAnchor">
<a href="#dynamic-occupancy-models-for-crossbill-data-from-the-swiss-mhb" class="anchor"></a>Dynamic occupancy models for crossbill data from the Swiss MHB</h1>
<div id="the-crossbill-data-set" class="section level2">
<h2 class="hasAnchor">
<a href="#the-crossbill-data-set" class="anchor"></a>The crossbill data set</h2>
<p>The crossbill data are included with the <code>unmarked</code> package. The dataset contains the results of nine years of surveys (1999–2007) for the European crossbill (<em>Loxia curvirostra</em>), a pine-seed eating finch, in 267 1-km<span class="math inline">\(^2\)</span> sample quadrats in Switzerland. Quadrats are surveyed annually as part of the Swiss breeding bird survey MHB <span class="citation">(Schmid et al. 2004)</span>. They are laid out as a grid over Switzerland and surveyed 2 or 3 times every breeding season (mid-April to late June) by experienced field ornithologists along a haphazard survey route of length 1-9 km (average 5 km). High-elevation sites are only surveyed twice per breeding season.</p>
</div>
<div id="importing-formatting-and-summarizing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#importing-formatting-and-summarizing-data" class="anchor"></a>Importing, formatting, and summarizing data</h2>
<p>The data can be loaded into an open R workspace using the <code>data</code> command.</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">crossbill</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">crossbill</span><span class="op">)</span></pre></div>
<pre><code>##  [1] "id"      "ele"     "forest"  "surveys" "det991"  "det992"  "det993" 
##  [8] "det001"  "det002"  "det003"  "det011"  "det012"  "det013"  "det021" 
## [15] "det022"  "det023"  "det031"  "det032"  "det033"  "det041"  "det042" 
## [22] "det043"  "det051"  "det052"  "det053"  "det061"  "det062"  "det063" 
## [29] "det071"  "det072"  "det073"  "date991" "date992" "date993" "date001"
## [36] "date002" "date003" "date011" "date012" "date013" "date021" "date022"
## [43] "date023" "date031" "date032" "date033" "date041" "date042" "date043"
## [50] "date051" "date052" "date053" "date061" "date062" "date063" "date071"
## [57] "date072" "date073"</code></pre>
<p>We have three covariates that vary by site: median elevation of the quadrat (<code>ele</code>, in metres), forest cover of the quadrat (<code>forest</code>, in percent) and the number of surveys per season (i.e., 2 or 3, surveys). These are called site covariates, because they vary by sites only. The 27 columns entitled <code>det991</code> - <code>det073</code> contain the crossbill detection/nondetection data during all surveys over the 9 years. They contain a 1 when at least one crossbill was recorded during a survey and a 0 otherwise. <code>NA</code>s indicate surveys that did not take place, either because a site is high-elevation and has no third survey or because it failed to be surveyed altogether in a year. The final 27 columns entitled <code>date991</code> - <code>date073</code> give the Julian date of each survey. They represent a “survey-covariate” or “observation covariate”. We note that the paper by <span class="citation">Royle (2007)</span> used a subset of this data set.</p>
<p>AIC-based model selection (see section 5.4) requires that all models are fit to the same data. <code>unmarked</code> removes missing data in a context specific way. For missing <code>siteCovs</code>, the entire row of data must be removed. However, for missing <code>yearlySiteCovs</code> or <code>obsCovs</code>, only the corresponding observation are removed. Thus, if <code>unmarked</code> removes different observations from different models, the models cannot be compared using AIC. A way around this is to remove the detection data corresponding to missing covariates before fitting the models. The crossbill data have missing dates and so we remove the associated detection/non-detection data.</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="va">DATE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">crossbill</span><span class="op">[</span>,<span class="fl">32</span><span class="op">:</span><span class="fl">58</span><span class="op">]</span><span class="op">)</span>
<span class="va">y.cross</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">crossbill</span><span class="op">[</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">31</span><span class="op">]</span><span class="op">)</span>
<span class="va">y.cross</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">DATE</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y.cross</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></pre></div>
<p>In addition, continuous covariates should be transformed in a way that brings their values close to zero in order to improve or even enable numerical convergence of the maximum-likelihood routine. We do this “by hand” and note that we could also have used the R function <code>scale</code>. We subtract the mean and divide by the standard deviation.</p>
<div class="sourceCode" id="cb32"><pre class="downlit">
<span class="va">sd.DATE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">DATE</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">mean.DATE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">DATE</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">DATE</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">DATE</span> <span class="op">-</span> <span class="va">mean.DATE</span><span class="op">)</span> <span class="op">/</span> <span class="va">sd.DATE</span></pre></div>
<p>Before we can fit occupancy models, we need to format this data set appropriately.</p>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="fl">1999</span><span class="op">:</span><span class="fl">2007</span><span class="op">)</span>
<span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">years</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">crossbill</span><span class="op">)</span>, <span class="fl">9</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">umf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedMultFrame.html">unmarkedMultFrame</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y.cross</span>,
    siteCovs<span class="op">=</span><span class="va">crossbill</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, yearlySiteCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>year<span class="op">=</span><span class="va">years</span><span class="op">)</span>,
    obsCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">DATE</span><span class="op">)</span>,
    numPrimary<span class="op">=</span><span class="fl">9</span><span class="op">)</span></pre></div>
</div>
<div id="model-fitting-1" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting-1" class="anchor"></a>Model fitting</h2>
<p>We fit a series of models that represent different hypotheses about the colonization-extinction dynamics of Swiss crossbills at a spatial scale of 1 km<span class="math inline">\(^2\)</span>. We fit year effects on colonization and extinction in the means parameterization, but for detection probability, we choose an effects parameterization. The latter is more useful for getting predictions in the presence of other explanatory variables for that parameter. For model <code>fm5</code> with more complex covariate relationships, we use as starting values for the optimization routine the solution from a “neighboring” model with slightly less complexity, model <code>fm4</code>. Wise choice of starting values can be decisive for success or failure of maximum likelihood estimation.</p>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="co"># A model with constant parameters</span>
<span class="va">fm0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colext.html">colext</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span>, <span class="va">umf</span><span class="op">)</span>

<span class="co"># Like fm0, but with year-dependent detection</span>
<span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colext.html">colext</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span>, <span class="va">umf</span><span class="op">)</span>

<span class="co"># Like fm0, but with year-dependent colonization and extinction</span>
<span class="va">fm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colext.html">colext</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span>, <span class="va">umf</span><span class="op">)</span>

<span class="co"># A fully time-dependent model</span>
<span class="va">fm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colext.html">colext</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span>, <span class="va">umf</span><span class="op">)</span>

<span class="co"># Like fm3 with forest-dependence of 1st-year occupancy</span>
<span class="va">fm4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colext.html">colext</a></span><span class="op">(</span><span class="op">~</span><span class="va">forest</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span>, <span class="va">umf</span><span class="op">)</span>

<span class="co"># Like fm4 with date- and year-dependence of detection</span>
<span class="va">fm5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colext.html">colext</a></span><span class="op">(</span><span class="op">~</span><span class="va">forest</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span> <span class="op">+</span> <span class="va">date</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">date</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,
              <span class="va">umf</span>, starts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fm4</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Same as fm5, but with detection in addition depending on forest cover</span>
<span class="va">fm6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colext.html">colext</a></span><span class="op">(</span><span class="op">~</span><span class="va">forest</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span>, <span class="op">~</span><span class="va">year</span> <span class="op">+</span> <span class="va">date</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">date</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
              <span class="va">forest</span>, <span class="va">umf</span><span class="op">)</span></pre></div>
</div>
<div id="model-selection" class="section level2">
<h2 class="hasAnchor">
<a href="#model-selection" class="anchor"></a>Model selection</h2>
<p>We can compare models using the Akaike information criterion (<span class="math inline">\(AIC\)</span>). Note that <code>unmarked</code> yields <span class="math inline">\(AIC\)</span>, not <span class="math inline">\(AIC_c\)</span> because the latter would require the sample size, which is not really known for hierarchical models such as the dynamic occupancy model.</p>
<p>Model selection and model-averaged prediction in <code>unmarked</code> require that we create a list of models using <code>fitList</code>. This function organizes models and conducts a series of tests to ensure that the models were fit to the same data.</p>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitList.html">fitList</a></span><span class="op">(</span><span class="st">'psi(.)gam(.)eps(.)p(.)'</span>    <span class="op">=</span> <span class="va">fm0</span>,
                  <span class="st">'psi(.)gam(.)eps(.)p(Y)'</span>    <span class="op">=</span> <span class="va">fm1</span>,
                  <span class="st">'psi(.)gam(Y)eps(Y)p(.)'</span>    <span class="op">=</span> <span class="va">fm2</span>,
                  <span class="st">'psi(.)gam(Y)eps(Y)p(Y)'</span>    <span class="op">=</span> <span class="va">fm3</span>,
                  <span class="st">'psi(F)gam(Y)eps(Y)p(Y)'</span>    <span class="op">=</span> <span class="va">fm4</span>,
                  <span class="st">'psi(F)gam(Y)eps(Y)p(YD2)'</span>  <span class="op">=</span> <span class="va">fm5</span>,
                  <span class="st">'psi(F)gam(Y)eps(Y)p(YD2F)'</span> <span class="op">=</span> <span class="va">fm6</span><span class="op">)</span>
<span class="va">ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modSel.html">modSel</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span>
<span class="va">ms</span></pre></div>
<pre><code>##                           nPars     AIC  delta   AICwt cumltvWt
## psi(F)gam(Y)eps(Y)p(YD2F)    30 4986.39   0.00 1.0e+00     1.00
## psi(F)gam(Y)eps(Y)p(YD2)     29 5059.30  72.91 1.5e-16     1.00
## psi(F)gam(Y)eps(Y)p(Y)       27 5095.38 108.99 2.2e-24     1.00
## psi(.)gam(.)eps(.)p(Y)       12 5111.32 124.93 7.5e-28     1.00
## psi(.)gam(Y)eps(Y)p(Y)       26 5127.63 141.24 2.1e-31     1.00
## psi(.)gam(Y)eps(Y)p(.)       18 5170.54 184.15 1.0e-40     1.00
## psi(.)gam(.)eps(.)p(.)        4 5193.50 207.11 1.1e-45     1.00</code></pre>
<p>One model has overwhelming support, so we can base inference on that one alone. Before doing so, we point out how to extract coefficients from a <code>fitList</code> object, and convert the results to a <code>data.frame</code>, which could be exported from R.</p>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span>                            <span class="co"># Estimates only</span>
<span class="fu"><a href="../reference/SE-methods.html">SE</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span>                              <span class="co"># Standard errors only</span>
<span class="va">toExport</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">ms</span>, <span class="st">"data.frame"</span><span class="op">)</span>    <span class="co"># Everything</span></pre></div>
</div>
<div id="manipulating-results-prediction-and-plotting-1" class="section level2">
<h2 class="hasAnchor">
<a href="#manipulating-results-prediction-and-plotting-1" class="anchor"></a>Manipulating results: Prediction and plotting</h2>
<p>Fitted models can be used to predict expected outcomes when given new data. For example, one could ask “how many crossbills would you expect to find in a quadrat with 50% forest cover?” Prediction also offers a way of presenting the results of an analysis. We illustrate by plotting the predictions of <span class="math inline">\(\psi\)</span> and <span class="math inline">\(p\)</span> over the range of covariate values studied. Note that because we standardized date, we need to transform it back to its original scale after obtaining predictions on the standardized scale.</p>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.8</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>forest<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, length<span class="op">=</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span>
<span class="va">E.psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fm6</span>, type<span class="op">=</span><span class="st">"psi"</span>, newdata<span class="op">=</span><span class="va">nd</span>, appendData<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">E.psi</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">forest</span>, <span class="va">Predicted</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>,
         xlab<span class="op">=</span><span class="st">"Percent cover of forest"</span>,
         ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">hat</a></span><span class="op">(</span><span class="va">psi</span><span class="op">)</span><span class="op">)</span>, cex.lab<span class="op">=</span><span class="fl">0.8</span>, cex.axis<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">forest</span>, <span class="va">Predicted</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">SE</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">forest</span>, <span class="va">Predicted</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">SE</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>

<span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, length<span class="op">=</span><span class="fl">50</span><span class="op">)</span>,
                 year<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">"2005"</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                 forest<span class="op">=</span><span class="fl">50</span><span class="op">)</span>
<span class="va">E.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fm6</span>, type<span class="op">=</span><span class="st">"det"</span>, newdata<span class="op">=</span><span class="va">nd</span>, appendData<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">E.p</span><span class="op">$</span><span class="va">dateOrig</span> <span class="op">&lt;-</span> <span class="va">E.p</span><span class="op">$</span><span class="va">date</span><span class="op">*</span><span class="va">sd.DATE</span> <span class="op">+</span> <span class="va">mean.DATE</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">E.p</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">dateOrig</span>, <span class="va">Predicted</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>,
         xlab<span class="op">=</span><span class="st">"Julian date"</span>, ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">)</span>,
         cex.lab<span class="op">=</span><span class="fl">0.8</span>, cex.axis<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dateOrig</span>, <span class="va">Predicted</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">SE</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">dateOrig</span>, <span class="va">Predicted</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">SE</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">gray</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span></pre></div>
<div class="figure">
<img src="colext-pred-1.png" alt="Figure 4. Covariates"><p class="caption">Figure 4. Covariates</p>
</div>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></pre></div>
<p><strong>Acknowledgments</strong></p>
<p>Special thanks goes to Ian Fiske, the author of <code>colext</code> and the original developer of <code>unmarked</code>. Andy Royle provided the initial funding and support for the package. The questions of many people on the users’ list motivated the writing of this document.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Davison_1997">
<p>Davison, A. C., and D. V. Hinkley. 1997. Bootstrap methods and their application. Cambridge University Press.</p>
</div>
<div id="ref-Hanski_1998">
<p>Hanski, I. 1998. Metapopulation dynamics. Nature 396:41–49.</p>
</div>
<div id="ref-Hosmer_1997">
<p>Hosmer, D. W., T. Hosmer, S. le Cressie, and S. Lemeshow. 1997. A comparision of goodness-of-fit tests for the logistic regression model. Statistics in Medicine 16:965–980.</p>
</div>
<div id="ref-Kery_2010">
<p>Kéry, M. 2010. Introduction to WinBUGS for Ecologists. Academic Press.</p>
</div>
<div id="ref-Kery_2011">
<p>Kéry, M., and M. Schaub. 2011. Bayesian Population Analysis using WinBUGS: A Hierarchical Perspective. Academic Press.</p>
</div>
<div id="ref-Kery_2008">
<p>Kéry, M., and B. R. Schmidt. 2008. Imperfect detection and its consequences for monitoring for conservation. Community Ecology 9:207–2016.</p>
</div>
<div id="ref-MacKenzie_2004">
<p>MacKenzie, D. I., and L. Bailey. 2004. Assessing the fit of site-occupancy models. Journal of Agricultural, Biological, and Environmental Statistics 9:300–318.</p>
</div>
<div id="ref-mackenzie_estimating_2003">
<p>MacKenzie, D. I., J. D. Nichols, J. E. Hines, M. G. Knutson, and A. B. Franklin. 2003. Estimating site occupancy, colonization, and local extinction when a species is detected imperfectly. Ecology 84:2200–2207.</p>
</div>
<div id="ref-mackenzie_estimating_2002">
<p>MacKenzie, D. I., J. D. Nichols, G. B. Lachman, S. Droege, J. A. Royle, and C. A. Langtimm. 2002. Estimating site occupancy rates when detection probabilities are less than one. Ecology 83:2248–2255.</p>
</div>
<div id="ref-McCullagh_1989">
<p>McCullagh, P., and J. A. Nelder. 1989. Generalized linear models. Chapman; Hall.</p>
</div>
<div id="ref-Moilanen_2002">
<p>Moilanen, A. 2002. Implications of empirical data quality to metapopulation model parameter estimation and application. Oikos 96:516–530.</p>
</div>
<div id="ref-Royle_2007">
<p>Royle, and K., J. A. 2007. A Bayesian state-space formulation of dynamic occupancy models. Ecology 88:1813–1823.</p>
</div>
<div id="ref-royle_dorazio:2008">
<p>Royle, J. A., and R. M. Dorazio. 2008. Hierarchical modeling and inference in ecology: The analysis of data from populations, metapopulations and communities. Academic Press.</p>
</div>
<div id="ref-royle_estimating_2003">
<p>Royle, J. A., and J. D. Nichols. 2003. Estimating abundance from repeated presence-absence data or point counts. Ecology 84:777–790.</p>
</div>
<div id="ref-schmid_etal:2004">
<p>Schmid, H., N. Zbinden, and V. Keller. 2004. Überwachung der bestandsentwicklung häufiger brutvögel in der schweiz. Swiss Ornithological Institute Sempach Switzerland.</p>
</div>
<div id="ref-Tyre_2002">
<p>Tyre, A. J., B. Tenhumberg, S. A. Field, D. Niejalke, Parris K., and H. P. Possingham. 2003. Improving precision and reducing bias in biological surveys: Estimating false-negative error rates. Ecological Applications 13:1790–1801.</p>
</div>
<div id="ref-Weir_2009">
<p>Weir, I. J. F., L., and J. A. Royle. 2009. Trends in anuran occupancy from northeastern states of the North American Amphibian Monitoring Program. Herpetological Conservation and Biology 4:389–402.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://chandlerlab.uga.edu/richard-chandler-phd/">Richard Chandler</a>, <a href="https://kenkellner.com">Ken Kellner</a>, Ian Fiske, David Miller, Andy Royle, Jeff Hostetler, Rebecca Hutchinson, Adam Smith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
